{"version":3,"sources":["lib/contracts/escrow.tmpl.teal","AlgorandWalletConnector.tsx","App.tsx","index.tsx","lib/algorand.ts"],"names":["AlgorandWalletConnector","props","React","selectorOpen","setSelectorOpen","sessionWallet","updateWallet","handleSelectedWallet","e","a","choice","currentTarget","id","allowedWallets","undefined","wallet","disconnect","sw","SessionWallet","network","permissionCallback","connect","interval","setInterval","wc","localStorage","getItem","wcObj","JSON","parse","accounts","length","clearInterval","setAccountList","connected","then","success","walletOptions","Object","entries","k","v","push","large","fill","minimal","outlined","onClick","className","alt","src","img","darkMode","displayName","rightIcon","intent","isOpen","title","onClose","Classes","DIALOG_BODY","addr_list","accts","map","addr","idx","value","substr","onChange","setAccountIndex","parseInt","target","iconProps","icon","defaultValue","accountIndex","ClaimDialog","useState","open","setIsOpen","signed","setSigned","progress","setProgress","handleClose","useCallback","useEffect","p","animate","App","conf","setSessionWallet","url","name","nft","setNFT","accountList","setAccounts","setConnected","claimable","setClaimable","loading","setLoading","setOpen","params","URLSearchParams","window","location","search","escrow","get","secret","getAsaId","asaId","collect","txn_group","sendWait","getNFT","Group","align","Alignment","LEFT","Heading","RIGHT","console","log","elevation","Elevation","FOUR","text","disabled","ReactDOM","render","StrictMode","document","getElementById","seeder","algod","host","port","token","client","algosdk","Algodv2","claimer","getDefaultAccount","getLsig","lsig","getTransactionParams","do","sp","lastRound","firstRound","optinTxn","Transaction","from","to","assetIndex","type","TransactionType","axfer","amount","xferTxn","closeRemainderTo","closeTxn","pay","grouped","assignGroupID","args","createSignature","txID","s_xfer","signLogicSigTransactionObject","s_close","signTxn","s_optin","txid","pd","Buffer","decodeAddress","publicKey","btxid","base32","decode","asBytes","toSign","Uint8Array","set","sk","nacl","sign","detached","getAssetByID","asa","accountInformation","ai","Error","addrHex","toString","get_file","escrow_template","tmpl","replace","compile","compiled","LogicSigAccount","program","fetch","response","checkStatus","arrayBuffer","buffer","TextDecoder","catch","err","error","ok","status","statusText","sendRawTransaction","t","blob","txId","waitForConfirmation","result","algodclient","timeout","startround","currentround","pendingTransactionInformation","pending","statusAfterBlock"],"mappings":"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","file":"static/js/main.086c06df.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/escrow.tmpl.13c08d54.teal\";","import * as React from 'react'\n\nimport { SessionWallet, allowedWallets } from 'algorand-session-wallet'\n\nimport { Dialog, Button, Classes, HTMLSelect, Intent } from '@blueprintjs/core'\nimport { IconName } from '@blueprintjs/icons'\n\n\ntype AlgorandWalletConnectorProps = {\n    darkMode: boolean\n    connected: boolean\n    accts: string[]\n    sessionWallet: SessionWallet\n    updateWallet(sw: SessionWallet): void\n}\n\nexport default function AlgorandWalletConnector(props:AlgorandWalletConnectorProps)  {\n\n    const [selectorOpen, setSelectorOpen] = React.useState(false)\n\n    const {sessionWallet,updateWallet} = props\n    React.useEffect(()=>{\n        if(sessionWallet.connected()) return\n\n        let interval: any\n        sessionWallet.connect().then((success)=>{\n            if(!success) return\n\n            // Check every 500ms to see if we've connected then kill the interval\n            // This is most useful in the case of walletconnect where it may be several \n            // seconds before the user connects\n            interval = setInterval(()=>{\n                if(sessionWallet.connected()) {\n                    clearInterval(interval)\n                    updateWallet(sessionWallet)\n                }\n            }, 500)\n\n        })\n\n        return ()=>{ clearInterval(interval) }\n\n    }, [sessionWallet, updateWallet])\n\n\n    function disconnectWallet() { \n        props.sessionWallet.disconnect()\n        props.updateWallet(new SessionWallet(props.sessionWallet.network, props.sessionWallet.permissionCallback)) \n    }\n\n    function handleDisplayWalletSelection() { setSelectorOpen(true) }\n\n    async function handleSelectedWallet(e: any) {\n        const choice = e.currentTarget.id\n\n        if(!(choice in allowedWallets)) {\n            if(props.sessionWallet.wallet !== undefined) props.sessionWallet.disconnect()\n            return setSelectorOpen(false)\n        }\n\n        const sw = new SessionWallet(props.sessionWallet.network, props.sessionWallet.permissionCallback, choice)\n\n        if(!await sw.connect()) {\n            sw.disconnect()\n        }\n\n        const interval = setInterval(()=>{\n            // If they've already connected, we wont get an on connect, have to check here\n            const wc = localStorage.getItem(\"walletconnect\")\n            if(wc === null || wc === undefined || wc === \"\") return;\n\n            const wcObj = JSON.parse(wc)\n            const accounts = wcObj.accounts\n            if(accounts.length>0){\n                clearInterval(interval)\n                sw.setAccountList(wcObj.accounts)\n                props.updateWallet(new SessionWallet(sw.network, sw.permissionCallback, choice))\n            }\n        }, 250)\n\n        props.updateWallet(sw)\n\n        setSelectorOpen(false)\n    }\n\n    function handleChangeAccount(e: any) {\n        props.sessionWallet.setAccountIndex(parseInt(e.target.value))\n        props.updateWallet(props.sessionWallet)\n    }\n\n    const walletOptions = []\n    for(const [k,v] of Object.entries(allowedWallets)){\n        // NOTE: remove if you want other wallets\n        if(k !== \"wallet-connect\") continue\n\n        walletOptions.push((\n        <li key={k}>\n            <Button id={k}\n                large={true} \n                fill={true} \n                minimal={true} \n                outlined={true} \n                onClick={handleSelectedWallet}\n                > \n                <div className='wallet-option'>\n                    <img alt='wallet-branding' className='wallet-branding' src={  v.img(props.darkMode)} />\n                    <h5>{v.displayName()}</h5>\n                </div>\n                </Button>\n        </li>\n        ))\n    }\n\n    if (!props.connected) return (\n        <div>\n            <Button\n                minimal={true}\n                rightIcon='selection'\n                intent='warning'\n                outlined={true}\n                onClick={handleDisplayWalletSelection}>Connect</Button>\n\n            <Dialog isOpen={selectorOpen} title='Select Wallet' onClose={handleSelectedWallet} >\n                <div className={Classes.DIALOG_BODY}>\n                    <ul className='wallet-option-list'>\n                        {walletOptions}\n                    </ul>\n                </div>\n            </Dialog>\n        </div>\n    )\n\n\n    const addr_list = props.accts.map((addr, idx) => {\n        return (<option value={idx} key={idx}> {addr.substr(0, 8)}...  </option>)\n    })\n\n    const iconprops = { \n        icon: 'symbol-circle' as IconName, \n        intent: 'success'  as Intent\n    }\n\n    return (\n        <div>\n            <HTMLSelect \n                onChange={handleChangeAccount} \n                minimal={true} \n                iconProps={iconprops} \n                defaultValue={props.sessionWallet.accountIndex()} >\n                {addr_list}\n            </HTMLSelect>\n            <Button icon='log-out' minimal={true} onClick={disconnectWallet} ></Button>\n        </div>\n    )\n}","import React, { useEffect } from 'react'\nimport { SessionWallet } from 'algorand-session-wallet';\nimport AlgorandWalletConnector from './AlgorandWalletConnector'\nimport { Alignment, Button, Card, Elevation, Navbar, ProgressBar } from '@blueprintjs/core';\nimport { conf, collect, sendWait, getAsaId, getNFT }  from './lib/algorand'\nimport { Classes, Dialog } from \"@blueprintjs/core\";\n\n\n\n\nfunction App() {\n  const sw = new SessionWallet(conf.network)\n  const [sessionWallet, setSessionWallet] =  React.useState(sw)\n\n  const [nft, setNFT]               = React.useState({id: 0, url:'algo-gator.png', name:\"TBD\"})\n  const [accts, setAccounts]        = React.useState(sw.accountList())\n  const [connected, setConnected]   = React.useState(sw.connected())\n  const [claimable, setClaimable]   = React.useState(true)\n\n  const [loading, setLoading]       = React.useState(false)\n  const [signed, setSigned]         = React.useState(false)\n  const [open, setOpen]             = React.useState(false)\n\n\n  const params  = new URLSearchParams(window.location.search);\n  const escrow  = params.get(\"escrow\")\n  const addr    = params.get(\"addr\")\n  const secret  = params.get(\"secret\")\n\n  useEffect(()=>{\n    if(secret === null || addr === null || escrow === null){\n      setClaimable(false)\n    }\n  }, [escrow, addr, secret])\n  \n\n  function updateWallet(sw: SessionWallet){ \n    setSessionWallet(sw)\n\n    console.log(\"In update wallet with account list: \", sw.accountList())\n    setAccounts(sw.accountList())\n    setConnected(sw.connected())\n  }\n\n  async function handleCollect() {\n    if(secret === null || addr == null || escrow == null){\n      return\n    }\n\n    setLoading(true)\n    setOpen(true)\n\n    const asaId = await getAsaId(escrow)\n    const txn_group = await collect(sw, asaId, escrow, addr, secret)\n\n    setSigned(true)\n\n    await sendWait(txn_group)\n\n    const nft = await getNFT(asaId)\n\n    setNFT(nft)\n    setOpen(false)\n    setLoading(false)\n\n  }\n\n /*\n\nFor #1-444 (IRL)\nCongrats on successfully collecting your Decipher Ticket!\nPlease make sure the asset is in your Algorand Mobile Wallet and ready to be presented when you arrive at the venue.\nSee you at Decipher!\n-----------------------------------\nFor #445-888 (Virtual)\nCongrats on successfully collecting your Algo Gator NFT!\nEnjoy it as a commemorative token that you’ve earned by being part of the Algorand community and signing up as a virtual VIP.\nSee you online at Decipher!\n  \n */\n\n  return (\n    <div className=\"App\">\n      <Navbar>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading><img alt='Algorand A' className='header-icon' src='favicon.ico' /></Navbar.Heading>\n        </Navbar.Group>\n        <Navbar.Group  align={Alignment.RIGHT}>\n          <AlgorandWalletConnector  \n            darkMode={true}\n            sessionWallet={sessionWallet}\n            accts={accts}\n            connected={connected} \n            updateWallet={updateWallet}\n          />\n        </Navbar.Group>\n      </Navbar>\n      <div className='container'>\n        <Card elevation={Elevation.FOUR} className='ticket-card'>\n          <div className='content'>\n\n            <div className='content-piece' >\n              <img alt='NFT' className='gator' src={nft.url} />\n            </div>\n            <div className='content-details' >\n\n              <div className='detail-prose' >\n                <h3> Greetings Algonaut</h3>\n                <p> \n                  Connect your wallet and claim your ticket\n                </p>\n              </div>\n\n\n              <div className='collect-button' >\n                <Button \n                    minimal={true} \n                    outlined={true} \n                    intent='success' \n                    large={true} \n                    icon='circle' \n                    text='Collect' \n                    onClick={handleCollect}  \n                    disabled={!claimable || !connected}\n                    loading={loading}\n                  />\n                </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n      <ClaimDialog open={open} signed={signed} />\n    </div>\n  );\n}\n\ninterface ClaimDialogProps {\n  open: boolean\n  signed: boolean\n}\n\nfunction ClaimDialog(props: ClaimDialogProps){\n  const [isOpen, setIsOpen] = React.useState(props.open)\n  const [signed, setSigned] = React.useState(props.signed)\n  const [progress, setProgress] = React.useState(0)\n\n  const handleClose = React.useCallback(() => setIsOpen(false), []);\n\n  useEffect(() => {\n    setIsOpen(props.open)\n    setSigned(props.signed)\n  }, [props])\n\n  useEffect(()=>{\n    let p = 0\n    if(!signed || progress > 0 || progress >= 1.0) return;\n\n    // 8 second \"fake\" timer just to give enough time to submit txn and \n    // have it confirmed on the network, then load the NFT details\n    const step = 100 / (8 * 1000) \n    const interval = setInterval(()=>{\n        p += step\n        if(p > 1.0) {\n          clearInterval(interval)\n          setProgress(1.0)\n          return\n        }\n        setProgress(p)\n    }, 100)\n\n  }, [signed, progress])\n\n  return (\n      <Dialog isOpen={isOpen} onClose={handleClose}>\n        <div className={Classes.DIALOG_BODY}>\n          {!signed?(\n          <div className='container'>\n            <p>Please Approve the transaction in your Mobile Wallet</p>\n          </div>\n          ):(\n            <ProgressBar animate={true} intent='success' value={progress} />\n          )}\n        </div>\n      </Dialog>\n    );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);","import algosdk, { LogicSigAccount, Transaction, TransactionType } from 'algosdk'\nimport { SessionWallet } from 'algorand-session-wallet';\nimport base32 from 'hi-base32';\nimport nacl from 'tweetnacl';\n\n//@ts-ignore\nimport escrow_template from './contracts/escrow.tmpl.teal'\n\nexport const conf = {\n    seeder: \"XPLR7X7LQESKDK3SJYGLM7XJRN7FSINV3AZXKAQIZM4CXAM2ATLQQYXLCA\",\n    network: \"TestNet\",\n    algod : {\n        host : \"https://testnet.algoexplorerapi.io\",\n        port : \"\",\n        token : \"\",\n    }\n}\n\nconst client = new algosdk.Algodv2(conf.algod.token, conf.algod.host , conf.algod.port)\n\ninterface SignedTxn {\n    txID: string,\n    blob: Uint8Array\n}\n\nexport interface NFT {\n    id: number\n    url: string\n    name: string\n}\n\nexport async function collect(sw: SessionWallet, asaId: number, escrow: string, addr: string, secret: string): Promise<SignedTxn[]> {\n\n    const claimer = sw.getDefaultAccount()\n\n    const lsig = await getLsig(addr)\n\n    const sp = await client.getTransactionParams().do()\n    sp.lastRound = sp.firstRound + 10\n\n    const optinTxn = new Transaction({\n        from:claimer,\n        to:claimer,\n        assetIndex: asaId,\n        type:TransactionType.axfer,\n        amount:0,\n        ...sp\n    }) \n\n    const xferTxn = new Transaction({\n        from:escrow,\n        to:claimer,\n        assetIndex: asaId,\n        type:TransactionType.axfer,\n        amount:0,\n        closeRemainderTo: claimer,\n        ...sp\n    }) \n\n    const closeTxn = new Transaction({\n        from:escrow,\n        to:conf.seeder,\n        type:TransactionType.pay,\n        amount:0,\n        closeRemainderTo: conf.seeder,\n        ...sp\n    })\n\n    const grouped = [optinTxn, xferTxn, closeTxn]\n\n    algosdk.assignGroupID(grouped)\n\n    lsig.lsig.args = [createSignature(xferTxn.txID(), escrow, secret)]\n\n    const s_xfer = algosdk.signLogicSigTransactionObject(xferTxn, lsig)\n    const s_close = algosdk.signLogicSigTransactionObject(closeTxn, lsig)\n\n    const [s_optin, /*xfer*/ , /*close*/] = await sw.signTxn(grouped)\n    //const s_optin = algosdk.signTransaction(optinTxn, sk.sk)\n\n    return [s_optin, s_xfer, s_close]\n}\n\nfunction createSignature(txid: string, escrow: string, secret: string): Uint8Array {\n    const pd    = Buffer.from(\"ProgData\")\n    const addr  = algosdk.decodeAddress(escrow).publicKey\n    const btxid = base32.decode.asBytes(txid)\n\n    const toSign = new Uint8Array(pd.length + addr.length + btxid.length)\n    toSign.set(pd, 0)\n    toSign.set(addr, pd.length)\n    toSign.set(btxid, pd.length + addr.length)\n\n    const sk = Buffer.from(secret, \"base64\")\n    return nacl.sign.detached(toSign, sk);\n}\n\nexport async function getNFT(asaId: number): Promise<NFT> {\n    const asa = await client.getAssetByID(asaId).do()\n    const p = asa['params']\n    console.log(asa)\n    return {\n        id:   asaId,\n        url:  p['url'],\n        name: p['name']\n    } as NFT\n}\n\nexport async function getAsaId(escrow: string): Promise<number> {\n    const ai = await client.accountInformation(escrow).do()\n    if(ai['assets'].length !== 1) throw Error(\"wat\")\n    return ai['assets'][0]['asset-id']\n}\n\nasync function getLsig(addr: string): Promise<LogicSigAccount> {\n    const addrHex   = \"0x\"+Buffer.from(algosdk.decodeAddress(addr).publicKey).toString(\"hex\")\n\n    const tmpl      = await get_file(escrow_template)\n    const src       = tmpl.replace(\"TMPL_GEN_ADDR\", addrHex)\n\n    const compiled  = await client.compile(src).do()\n\n    return new LogicSigAccount(Buffer.from(compiled['result'], \"base64\"))\n}\n\nasync function get_file(program: string): Promise<string> {\n    return await fetch(program)\n        .then(response => checkStatus(response) && response.arrayBuffer())\n        .then(buffer => {\n            const td = new TextDecoder()\n            return td.decode(buffer)\n        }).catch(err => {\n            console.error(err)\n            return \"\"\n        });\n}\n\nfunction checkStatus(response: Response) {\n    if (!response.ok) throw new Error(`HTTP ${response.status} - ${response.statusText}`);\n    return response;\n}\n\n// Send transactions to the network \nexport async function sendWait(signed: SignedTxn[]): Promise<any> {\n    const {txId}  = await client.sendRawTransaction(signed.map((t)=>{return t.blob})).do()\n    const result = await waitForConfirmation(client, txId, 3)\n    return result \n}\n\nasync function waitForConfirmation(algodclient: algosdk.Algodv2, txId: string, timeout: number): Promise<any> {\n    if (algodclient == null || txId == null || timeout < 0) {\n      throw new Error('Bad arguments.');\n    }\n\n    const status = await algodclient.status().do();\n    if (typeof status === 'undefined')\n      throw new Error('Unable to get node status');\n\n    const startround = status['last-round'] + 1;\n    let currentround = startround;\n  \n    /* eslint-disable no-await-in-loop */\n    while (currentround < startround + timeout) {\n      const pending = await algodclient\n        .pendingTransactionInformation(txId)\n        .do();\n\n      if (pending !== undefined) {\n        if ( pending['confirmed-round'] !== null && pending['confirmed-round'] > 0) \n          return pending;\n  \n        if ( pending['pool-error'] != null && pending['pool-error'].length > 0) \n          throw new Error( `Transaction Rejected pool error${pending['pool-error']}`);\n      }\n\n      await algodclient.statusAfterBlock(currentround).do();\n      currentround += 1;\n    }\n\n    /* eslint-enable no-await-in-loop */\n    throw new Error(`Transaction not confirmed after ${timeout} rounds!`);\n}\n"],"sourceRoot":""}