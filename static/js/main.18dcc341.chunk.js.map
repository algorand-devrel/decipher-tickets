{"version":3,"sources":["lib/contracts/escrow.tmpl.teal","AlgorandWalletConnector.tsx","App.tsx","index.tsx","lib/algorand.ts"],"names":["AlgorandWalletConnector","props","React","selectorOpen","setSelectorOpen","sessionWallet","updateWallet","handleSelectedWallet","e","a","choice","currentTarget","id","allowedWallets","undefined","wallet","disconnect","sw","SessionWallet","network","permissionCallback","connect","interval","setInterval","wc","localStorage","getItem","wcObj","JSON","parse","accounts","length","clearInterval","setAccountList","connected","then","success","walletOptions","Object","entries","k","v","push","large","fill","minimal","outlined","onClick","className","alt","src","img","darkMode","displayName","style","color","borderColor","borderRadius","rightIcon","intent","isOpen","title","onClose","Classes","DIALOG_BODY","addr_list","accts","map","addr","idx","value","substr","onChange","setAccountIndex","parseInt","target","iconProps","icon","defaultValue","accountIndex","HelpDropdown","useState","setIsOpen","canEscapeKeyClose","canOutsideClickClose","isCloseButtonShown","href","ClaimDialog","open","signed","setSigned","progress","setProgress","handleClose","useCallback","useEffect","p","background","animate","App","conf","setSessionWallet","url","name","nft","setNFT","accountList","setAccounts","setConnected","claimable","setClaimable","loading","setLoading","setOpen","params","URLSearchParams","window","location","search","escrow","get","secret","getAsaId","asaId","nftpromise","getNFT","collect","txn_group","sendWait","message","Group","align","Alignment","LEFT","Heading","RIGHT","elevation","Elevation","FOUR","visibility","width","marginTop","text","disabled","ReactDOM","render","StrictMode","document","getElementById","seeder","algod","host","port","token","client","algosdk","Algodv2","claimer","getDefaultAccount","getLsig","lsig","getTransactionParams","do","sp","optinTxn","Transaction","from","to","assetIndex","type","TransactionType","axfer","amount","xferTxn","closeRemainderTo","closeTxn","pay","grouped","assignGroupID","args","createSignature","txID","s_xfer","signLogicSigTransactionObject","s_close","signTxn","s_optin","txid","pd","Buffer","decodeAddress","publicKey","btxid","base32","decode","asBytes","toSign","Uint8Array","set","sk","nacl","sign","detached","getAssetByID","asa","cid","split","accountInformation","ai","Error","addrHex","toString","get_file","escrow_template","tmpl","replace","compile","compiled","LogicSigAccount","program","fetch","response","checkStatus","arrayBuffer","buffer","TextDecoder","catch","err","console","error","ok","status","statusText","sendRawTransaction","t","blob","txId","waitForConfirmation","result","algodclient","timeout","startround","currentround","pendingTransactionInformation","pending","statusAfterBlock"],"mappings":"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","file":"static/js/main.18dcc341.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/escrow.tmpl.091ece65.teal\";","import * as React from 'react'\n\nimport { SessionWallet, allowedWallets } from 'algorand-session-wallet'\n\nimport { Dialog, Button, Classes, HTMLSelect, Intent } from '@blueprintjs/core'\nimport { IconName } from '@blueprintjs/icons'\n\n\ntype AlgorandWalletConnectorProps = {\n    darkMode: boolean\n    connected: boolean\n    accts: string[]\n    sessionWallet: SessionWallet\n    updateWallet(sw: SessionWallet): void\n}\n\nexport default function AlgorandWalletConnector(props:AlgorandWalletConnectorProps)  {\n\n    const [selectorOpen, setSelectorOpen] = React.useState(false)\n\n    const {sessionWallet,updateWallet} = props\n    React.useEffect(()=>{\n        if(sessionWallet.connected()) return\n\n        let interval: any\n        sessionWallet.connect().then((success)=>{\n            if(!success) return\n\n            // Check every 500ms to see if we've connected then kill the interval\n            // This is most useful in the case of walletconnect where it may be several \n            // seconds before the user connects\n            interval = setInterval(()=>{\n                if(sessionWallet.connected()) {\n                    clearInterval(interval)\n                    updateWallet(sessionWallet)\n                }\n            }, 500)\n\n        })\n\n        return ()=>{ clearInterval(interval) }\n\n    }, [sessionWallet, updateWallet])\n\n\n    function disconnectWallet() { \n        props.sessionWallet.disconnect()\n        props.updateWallet(new SessionWallet(props.sessionWallet.network, props.sessionWallet.permissionCallback)) \n    }\n\n    function handleDisplayWalletSelection() { setSelectorOpen(true) }\n\n    async function handleSelectedWallet(e: any) {\n        const choice = e.currentTarget.id\n\n        if(!(choice in allowedWallets)) {\n            if(props.sessionWallet.wallet !== undefined) props.sessionWallet.disconnect()\n            return setSelectorOpen(false)\n        }\n\n        const sw = new SessionWallet(props.sessionWallet.network, props.sessionWallet.permissionCallback, choice)\n\n        if(!await sw.connect()) {\n            sw.disconnect()\n        }\n\n        const interval = setInterval(()=>{\n            // If they've already connected, we wont get an on connect, have to check here\n            const wc = localStorage.getItem(\"walletconnect\")\n            if(wc === null || wc === undefined || wc === \"\") return;\n\n            const wcObj = JSON.parse(wc)\n            const accounts = wcObj.accounts\n            if(accounts.length>0){\n                clearInterval(interval)\n                sw.setAccountList(wcObj.accounts)\n                props.updateWallet(new SessionWallet(sw.network, sw.permissionCallback, choice))\n            }\n        }, 250)\n\n        props.updateWallet(sw)\n\n        setSelectorOpen(false)\n    }\n\n    function handleChangeAccount(e: any) {\n        props.sessionWallet.setAccountIndex(parseInt(e.target.value))\n        props.updateWallet(props.sessionWallet)\n    }\n\n    const walletOptions = []\n    for(const [k,v] of Object.entries(allowedWallets)){\n        // NOTE: remove if you want other wallets\n        if(k !== \"wallet-connect\") continue\n\n        walletOptions.push((\n        <li key={k}>\n            <Button id={k}\n                large={true} \n                fill={true} \n                minimal={true} \n                outlined={true} \n                onClick={handleSelectedWallet}\n                > \n                <div className='wallet-option'>\n                    <img alt='wallet-branding' className='wallet-branding' src={  v.img(props.darkMode)} />\n                    <h5>{v.displayName()}</h5>\n                </div>\n                </Button>\n        </li>\n        ))\n    }\n\n    if (!props.connected) return (\n        <div>\n            <Button\n                minimal={true}\n                style={{color: 'white', borderColor: 'white', borderRadius: '8px'}}\n                rightIcon='selection'\n                intent='warning'\n                outlined={true}\n                onClick={handleDisplayWalletSelection}>Connect</Button>\n\n            <Dialog isOpen={selectorOpen} title='Select Wallet' onClose={handleSelectedWallet} >\n                <div className={Classes.DIALOG_BODY}>\n                    <ul className='wallet-option-list'>\n                        {walletOptions}\n                    </ul>\n                </div>\n            </Dialog>\n        </div>\n    )\n\n\n    const addr_list = props.accts.map((addr, idx) => {\n        return (<option value={idx} key={idx}> {addr.substr(0, 8)}...  </option>)\n    })\n\n    const iconprops = { \n        icon: 'symbol-circle' as IconName, \n        intent: 'success'  as Intent\n    }\n\n    return (\n        <div>\n            <HTMLSelect \n                onChange={handleChangeAccount} \n                minimal={true} \n                iconProps={iconprops} \n                defaultValue={props.sessionWallet.accountIndex()} >\n                {addr_list}\n            </HTMLSelect>\n            <Button icon='log-out' minimal={true} onClick={disconnectWallet} ></Button>\n        </div>\n    )\n}","import React, { useEffect } from 'react'\nimport { SessionWallet } from 'algorand-session-wallet';\nimport AlgorandWalletConnector from './AlgorandWalletConnector'\nimport { Alignment, Button, Card, Elevation, Navbar, ProgressBar } from '@blueprintjs/core';\nimport { conf, collect, sendWait, getAsaId, getNFT }  from './lib/algorand'\nimport { Classes, Dialog } from \"@blueprintjs/core\";\nimport { BrowserView, MobileView } from 'react-device-detect'\n\n\n\nfunction App() {\n  const sw = new SessionWallet(conf.network)\n  const [sessionWallet, setSessionWallet] =  React.useState(sw)\n\n  const [nft, setNFT]               = React.useState({id: 0, url:'algo-gator.png', name:\"TBD\"})\n  const [accts, setAccounts]        = React.useState(sw.accountList())\n  const [connected, setConnected]   = React.useState(sw.connected())\n  const [claimable, setClaimable]   = React.useState(true)\n\n  const [loading, setLoading]       = React.useState(false)\n  const [signed, setSigned]         = React.useState(false)\n  const [open, setOpen]             = React.useState(false)\n\n\n  const params  = new URLSearchParams(window.location.search);\n  const escrow  = params.get(\"escrow\")\n  const addr    = params.get(\"addr\")\n  const secret  = params.get(\"secret\")\n\n  useEffect(()=>{\n    setClaimable(secret !== null && addr !== null && escrow !== null)\n  }, [escrow, addr, secret])\n  \n\n  function updateWallet(sw: SessionWallet){ \n    setSessionWallet(sw)\n    setAccounts(sw.accountList())\n    setConnected(sw.connected())\n  }\n\n  async function handleCollect() {\n    if(secret === null || addr == null || escrow == null){\n      return\n    }\n\n    setLoading(true)\n    setOpen(true)\n\n    const asaId = await getAsaId(escrow)\n\n    const nftpromise = getNFT(asaId)\n\n    const txn_group = await collect(sw, asaId, escrow, addr, secret)\n\n    setSigned(true)\n\n    await sendWait(txn_group)\n\n    setNFT(await nftpromise)\n    setClaimable(false)\n    setOpen(false)\n    setLoading(false)\n  }\n\n  let message = (\n    <div>\n      <h3> Greetings Algonaut!</h3> \n      <p> \n      Connect your wallet and collect your NFT ticket\n      </p>\n    </div>\n  )\n\n  if(nft.id !== 0) {\n    if(nft.id<420774977){\n        message = (\n          <div>\n            <h3> Congrats on successfully collecting your Decipher Ticket!  </h3>\n            <p>\n              Please make sure the asset is in your Algorand Mobile Wallet and ready to be presented when you arrive at the venue.\n              See you at Decipher!\n            </p>\n          </div>\n        )\n    }else{\n      message = (\n        <div>\n          <h3> Congrats on successfully collecting your Algo Gator NFT!  </h3>\n          <p>\n            Enjoy it as a commemorative token that you’ve earned by being part of the Algorand community and signing up as a virtual VIP.\n            See you online at Decipher!\n          </p>\n        </div>\n      )\n    }\n  }\n\n  return (\n    <div className=\"App\" style={{background: '#000'}}>\n      <Navbar style={{background: 'linear-gradient(90deg,#b72375 3%,#f37e33 97%)'}}>\n        <Navbar.Group align={Alignment.LEFT}>\n          <Navbar.Heading><img alt='Algorand A' className='header-icon' src='favicon.ico' /></Navbar.Heading>\n        </Navbar.Group>\n        <Navbar.Group  align={Alignment.RIGHT}>\n          <AlgorandWalletConnector  \n            darkMode={true}\n            sessionWallet={sessionWallet}\n            accts={accts}\n            connected={connected} \n            updateWallet={updateWallet}\n          />\n        </Navbar.Group>\n      </Navbar>\n      <div className='container'>\n        <Card elevation={Elevation.FOUR} className='ticket-card'>\n          <div className='content' >\n\n            <div className='content-piece' >\n              <img alt='NFT' className='gator' src={nft.url} />\n            </div>\n            <div className='content-details' >\n\n              <div className='detail-prose' style={{color: 'white'}} >\n                  {message}\n              </div>\n\n              <div className='collect-button' style={{visibility: nft.id === 0 ?'visible':'hidden'}}  >\n                <Button \n                    style={{color: 'white', borderColor: 'white', borderRadius: '8px', width: '100%', marginTop: '8px'}}\n                    minimal={true} \n                    outlined={true} \n                    intent='success' \n                    large={true} \n                    icon='circle' \n                    text='Collect' \n                    onClick={handleCollect}  \n                    disabled={!connected || !claimable}\n                    loading={loading}\n                  />\n                </div>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      <div className='container'>\n        <HelpDropdown />\n      </div>\n\n      <ClaimDialog open={open} signed={signed} />\n    </div>\n  );\n\n}\n\nfunction HelpDropdown() {\n  const [isOpen, setIsOpen] = React.useState(false)\n\n  return (\n    <div className='help-container'>\n      <Button icon='help' minimal={true} intent='primary' outlined={true} onClick={() => setIsOpen(true)} >\n        Need Help?\n      </Button>\n      <Dialog isOpen={isOpen} canEscapeKeyClose={true} canOutsideClickClose={true} isCloseButtonShown={true} onClose={() => setIsOpen(false)} >\n        <div className='container'>\n          <div className='help-text' >\n            <p style={{color: '#000 !important'}}>\n                <h3>How to collect your Algo Gator</h3>\n\n                <p>First, you will need to download the <a href=\"https://algorandwallet.com/\" >Algorand Wallet</a> and load it with at least 0.3 Algo.</p>\n\n                <p>Second, click the “Connect” button on the top right of this page and proceed as follows</p>\n                <BrowserView>\n                  <ul>\n                    <li>A pop-up will appear with the toggle on “Mobile” -- Click “Connect”</li>\n                    <li>Return to the landing page on your mobile browser. Your Algorand Wallet address should now appear on the top right corner of the page</li>\n                    <li>Click “Collect” to receive your asset</li>\n                  </ul>\n                </BrowserView>\n                <MobileView>\n                  <ul>\n                    <li>Scan the QR code using the scanner within your mobile Algorand Wallet </li>\n                    <li>A pop-up will appear within the mobile app -- Click “Connect”</li>\n                    <li>At this point, your Algorand Wallet address will appear on the top right corner of the desktop landing page</li>\n                    <li>Click “Collect” on the web page, and then “Approve” the transaction within your mobile wallet</li>\n                  </ul>\n                </MobileView>\n                <p>\n                  Once approved and the transaction is processed, your unique 1/1 Algo Gator NFT asset will appear on this page and within your mobile Algorand wallet. (Note that the Algorand Wallet will show the Asset Name and Asset ID, not an actual image of the NFT). \n                </p>\n\n                <p>\n                  If you have any issues with the claiming process, please <a href=\"mailto:decipherevent@algorand.com\">reach out</a> for assistance. \n                </p>\n\n            </p>\n          </div>\n        </div>\n      </Dialog>\n    </div>\n  )\n\n}\n\n\ninterface ClaimDialogProps {\n  open: boolean\n  signed: boolean\n}\n\nfunction ClaimDialog(props: ClaimDialogProps){\n  const [isOpen, setIsOpen] = React.useState(props.open)\n  const [signed, setSigned] = React.useState(props.signed)\n  const [progress, setProgress] = React.useState(0)\n\n  const handleClose = React.useCallback(() => setIsOpen(false), []);\n\n  useEffect(() => {\n    setIsOpen(props.open)\n    setSigned(props.signed)\n  }, [props])\n\n  useEffect(()=>{\n    let p = 0\n    if(!signed || progress > 0 || progress >= 1.0) return;\n\n    // \"fake\" timer just to give enough time to submit txn and \n    // have it confirmed on the network, then load the NFT details\n    const step = 100 / (6 * 1000) \n    const interval = setInterval(()=>{\n        p += step\n        if(p > 1.0) {\n          clearInterval(interval)\n          setProgress(1.0)\n          return\n        }\n        setProgress(p)\n    }, 100)\n\n  }, [signed, progress])\n\n  return (\n      <Dialog isOpen={isOpen} onClose={handleClose} style={{background: '#000'}}>\n        <div className={Classes.DIALOG_BODY}>\n          {!signed?(\n          <div className='container' style={{color:'white'}}>\n            <p><b>Please Approve the transaction in your Mobile Wallet. </b></p>\n            <p>You may have to refresh your Wallet Connect session</p>\n            <p>On your mobile app under Settings - Wallet Connect</p>\n          </div>\n          ):(\n            <ProgressBar animate={true} intent='success' value={progress} />\n          )}\n        </div>\n      </Dialog>\n    );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);","import algosdk, { LogicSigAccount, Transaction, TransactionType } from 'algosdk'\nimport { SessionWallet } from 'algorand-session-wallet';\nimport base32 from 'hi-base32';\nimport nacl from 'tweetnacl';\n\n//@ts-ignore\nimport escrow_template from './contracts/escrow.tmpl.teal'\n\nexport const conf = {\n    seeder: \"DCIPMQ3SDOVBX5IUY65LR7BZ2R63JCULO72J7IS3W2PUNW7JTAGYEHBRRA\",\n    network: \"MainNet\",\n    algod : {\n        host : \"https://algoexplorerapi.io\",\n        port : \"\",\n        token : \"\",\n    }\n}\n\nconst client = new algosdk.Algodv2(conf.algod.token, conf.algod.host , conf.algod.port)\n\ninterface SignedTxn {\n    txID: string,\n    blob: Uint8Array\n}\n\nexport interface NFT {\n    id: number\n    url: string\n    name: string\n}\n\nexport async function collect(sw: SessionWallet, asaId: number, escrow: string, addr: string, secret: string): Promise<SignedTxn[]> {\n\n    const claimer = sw.getDefaultAccount()\n\n    const lsig = await getLsig(addr)\n\n    const sp = await client.getTransactionParams().do()\n\n    const optinTxn = new Transaction({\n        from:claimer,\n        to:claimer,\n        assetIndex: asaId,\n        type:TransactionType.axfer,\n        amount:0,\n        ...sp\n    }) \n\n    const xferTxn = new Transaction({\n        from:escrow,\n        to:claimer,\n        assetIndex: asaId,\n        type:TransactionType.axfer,\n        amount:0,\n        closeRemainderTo: claimer,\n        ...sp\n    }) \n\n    const closeTxn = new Transaction({\n        from:escrow,\n        to:conf.seeder,\n        type:TransactionType.pay,\n        amount:0,\n        closeRemainderTo: conf.seeder,\n        ...sp\n    })\n\n    const grouped = [optinTxn, xferTxn, closeTxn]\n\n    algosdk.assignGroupID(grouped)\n\n    lsig.lsig.args = [createSignature(xferTxn.txID(), escrow, secret)]\n\n    const s_xfer = algosdk.signLogicSigTransactionObject(xferTxn, lsig)\n    const s_close = algosdk.signLogicSigTransactionObject(closeTxn, lsig)\n\n    const [s_optin, /*xfer*/ , /*close*/] = await sw.signTxn(grouped)\n\n    return [s_optin, s_xfer, s_close]\n}\n\nfunction createSignature(txid: string, escrow: string, secret: string): Uint8Array {\n    const pd    = Buffer.from(\"ProgData\")\n    const addr  = algosdk.decodeAddress(escrow).publicKey\n    const btxid = base32.decode.asBytes(txid)\n\n    const toSign = new Uint8Array(pd.length + addr.length + btxid.length)\n    toSign.set(pd, 0)\n    toSign.set(addr, pd.length)\n    toSign.set(btxid, pd.length + addr.length)\n\n    const sk = Buffer.from(secret, \"base64\")\n    return nacl.sign.detached(toSign, sk);\n}\n\nexport async function getNFT(asaId: number): Promise<NFT> {\n    const asa = await client.getAssetByID(asaId).do()\n    const p = asa['params']\n\n    // Assumes ipfs:// protocol\n    const cid = p['url'].split(\"://\")\n    const url = \"https://ipfs.io/ipfs/\"+cid[1]\n    \n    return { id:   asaId, url:  url, name: p['name'] } as NFT\n}\n\nexport async function getAsaId(escrow: string): Promise<number> {\n    const ai = await client.accountInformation(escrow).do()\n    if(ai['assets'].length !== 1) throw Error(\"wat\")\n    return ai['assets'][0]['asset-id']\n}\n\nasync function getLsig(addr: string): Promise<LogicSigAccount> {\n    const addrHex   = \"0x\"+Buffer.from(algosdk.decodeAddress(addr).publicKey).toString(\"hex\")\n\n    const tmpl      = await get_file(escrow_template)\n    const src       = tmpl.replace(\"TMPL_GEN_ADDR\", addrHex)\n\n    const compiled  = await client.compile(src).do()\n\n    return new LogicSigAccount(Buffer.from(compiled['result'], \"base64\"))\n}\n\nasync function get_file(program: string): Promise<string> {\n    return await fetch(program)\n        .then(response => checkStatus(response) && response.arrayBuffer())\n        .then(buffer => {\n            const td = new TextDecoder()\n            return td.decode(buffer)\n        }).catch(err => {\n            console.error(err)\n            return \"\"\n        });\n}\n\nfunction checkStatus(response: Response) {\n    if (!response.ok) throw new Error(`HTTP ${response.status} - ${response.statusText}`);\n    return response;\n}\n\n// Send transactions to the network \nexport async function sendWait(signed: SignedTxn[]): Promise<any> {\n    const {txId}  = await client.sendRawTransaction(signed.map((t)=>{return t.blob})).do()\n    const result = await waitForConfirmation(client, txId, 3)\n    return result \n}\n\nasync function waitForConfirmation(algodclient: algosdk.Algodv2, txId: string, timeout: number): Promise<any> {\n    if (algodclient == null || txId == null || timeout < 0) {\n      throw new Error('Bad arguments.');\n    }\n\n    const status = await algodclient.status().do();\n    if (typeof status === 'undefined')\n      throw new Error('Unable to get node status');\n\n    const startround = status['last-round'] + 1;\n    let currentround = startround;\n  \n    /* eslint-disable no-await-in-loop */\n    while (currentround < startround + timeout) {\n      const pending = await algodclient\n        .pendingTransactionInformation(txId)\n        .do();\n\n      if (pending !== undefined) {\n        if ( pending['confirmed-round'] !== null && pending['confirmed-round'] > 0) \n          return pending;\n  \n        if ( pending['pool-error'] != null && pending['pool-error'].length > 0) \n          throw new Error( `Transaction Rejected pool error${pending['pool-error']}`);\n      }\n\n      await algodclient.statusAfterBlock(currentround).do();\n      currentround += 1;\n    }\n\n    /* eslint-enable no-await-in-loop */\n    throw new Error(`Transaction not confirmed after ${timeout} rounds!`);\n}\n"],"sourceRoot":""}